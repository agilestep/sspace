function Space(t={},e="body"){this.rootElement=e,this.bindCollections=BIND_COLLECTION,this.bindDictionary={},this.data=t,this.findAllDOMBindings(),this.buildBindCOllections(),this.buildLoops(),this.buildBindedData(this.data),this.buildRawExpressions(),this.bindInputs()}function SpaceArray(t=[]){this.list=[],this.length=0,this.render=!1;let e=this;this.push=function(t){return this[this.length]=t,this.length+=1,e.createArrayTriggers(this,t,this.length-1,freeArrayCount),e.render,this.list.push(t)},this.pop=function(){if(!(this.length<0))return this.length-=1,delete this[this.length],this.list.pop()},this.forEach=function(t){for(let e=0;e<this.list.length;e++)t(this.list[e])};for(let e=0;e<t.length;e++)this.push(t[e]);freeArrayCount+=1}const bracketsPresent=function(t){return t.search(/\{.*\}/)>-1},buildBracketsRegex=t=>new RegExp("{s?"+t+"s?}","g"),SPACE_BIND_SIMBOL="s-bind",SPACE_EACH_SYMBOL="s-each",S_BOUND="s-bound",S_EVAL="s-eval",BIND_COLLECTION={models:[],loops:[],expressions:[],directives:[]},LIST_NAMES={"s-bind":"models","s-each":"loops","s-eval":"expressions",directives:"directives"};let freeArrayCount=0;Space.prototype.bindInputs=function(){let t=this;for(let e=0;e<this.bindCollections.models.length;e++){let i=this.bindCollections.models[e],s=this.getItemsByClassName("sid"+i.id)[0],n=s.getAttribute(SPACE_BIND_SIMBOL),r=this.data[n];s.value!=r&&(s.value=r);let o=function(e){t.data[n]=e.target.value};s.removeEventListener("input",o),s.addEventListener("input",o),s.setAttribute(S_BOUND,"true")}},Space.prototype.replaceLoopItems=function(t,e,i){return Object.keys(i).forEach((s=>{let n=["i.",":",e+"."];for(let e=0;e<n.length;e++)t=this.replaceDirective(t,n[e]+s,i[s])})),t},Space.prototype.buildLoops=function(){let t=this.bindCollections.loops||[];for(let e=0;e<t.length;e++){let i=this.getItemsByClassName("sid"+t[e].id)[0],s=i.cloneNode(!0),n=i.getAttribute(SPACE_EACH_SYMBOL),r=null,o=!0,l=null,a=null,c=-1;this.data[n]&&this.data[n].forEach((d=>{c+=1;let h=n.toString()[0];a=t[e].initialHTML,a=this.replaceLoopItems(a,h,d),l=i,o?l.classList.add("s-loop"):(l=s.cloneNode(!0),l.removeAttribute(SPACE_EACH_SYMBOL),r.parentNode.insertBefore(l,r.nextSibling)),l.setAttribute("parent_sid",s.getAttribute("sid")),l.setAttribute("data_name",h),l.classList.add("lp_ch"+e+"_"+c),r=l,l.innerHTML=a,o=!1}))}},Space.prototype.geElementRawText=function(t){let e="";for(let i=0;i<t.childNodes.length;i++)t.childNodes[i].nodeType===Node.TEXT_NODE&&(e+=t.childNodes[i].textContent.trim());return e},Space.prototype.getDirectivesKeys=function(t){let e,i=[],s=/{([^}]+)}/g;for(;e=s.exec(t);)i.push(e[1]);return i},Space.prototype.buildBindCOllections=function(){let t=document.querySelectorAll(".sbind"),e="directive",i=this;t.forEach((t=>{e=t.getAttribute("slist");let s=[],n=[];if("directives"==e){let e=this.geElementRawText(t);s=this.getDirectivesKeys(e)}s.length>0&&s.forEach((function(e){let s="$item_"+t.getAttribute("sid");Array.isArray(i.bindDictionary[e])||(i.bindDictionary[e]=[]),Array.isArray(i.bindDictionary[s])||(i.bindDictionary[s]=[]),i.bindDictionary[e].push(t.getAttribute("sid")),i.bindDictionary[s].indexOf(e)<0&&i.bindDictionary[s].push(e),n.push(e)})),this.bindCollections[e].push({id:t.getAttribute("sid"),initialHTML:t.innerHTML,initialOuterHTML:t.outerHTML,bindedKeys:s});for(let e=0;e<n.length;e++){let i=n[e];this.data[i]&&(t.innerHTML=t.innerHTML.replace(buildBracketsRegex(i),this.data[i]))}}))},Space.prototype.findAllDOMBindings=function(){console.log(this.rootElement+" *");let t=document.querySelectorAll(this.rootElement+" *"),e=new RegExp("{.*?}"),i="directives",s=1;t.forEach((t=>{if("SCRIPT"!=t.tagName&&"STYLE"!=t.tagName){let n=this.geElementRawText(t);if(t.hasAttribute(SPACE_EACH_SYMBOL)||t.hasAttribute(SPACE_BIND_SIMBOL)||t.hasAttribute(S_EVAL)||n.match(e)){console.log(n),console.log(s);let e="directives";t.hasAttribute(SPACE_EACH_SYMBOL)&&(e=SPACE_EACH_SYMBOL),t.hasAttribute(SPACE_BIND_SIMBOL)&&(e=SPACE_BIND_SIMBOL),(t.hasAttribute(S_EVAL)||n.indexOf("${")>-1)&&(e=S_EVAL),i="s"+LIST_NAMES[e],t.setAttribute("sid",s),t.setAttribute("sList",LIST_NAMES[e]),t.classList.add("sid"+s,"sbind",i),s+=1}}}))},Space.prototype.getItemsByClassName=function(t){let e=document.getElementsByClassName(t);return Array.from(e)},Space.prototype.triggerRefresh=function(t,e){let i=this;this.bindDictionary[t]&&this.bindDictionary[t].forEach((function(s){i.renderItem(s,t,e)})),this.buildRawExpressions()},Space.prototype.replaceDirective=function(t,e,i){try{return t.replaceAll(buildBracketsRegex(e),i)}catch(e){return t}},Space.prototype.buildRawExpressions=function(){for(let t=0;t<this.bindCollections.expressions.length;t++){let e=this.bindCollections.expressions[t],i=this.getItemsByClassName("sid"+e.id)[0];Space.prototype.buildRawExpression(i,e,this.data)}},Space.prototype.buildRawExpression=function(t,e,i){if(e.initialHTML.toString().includes("${")){let s=[],n=/{([^}]+)}/g,r=null;for(;r=n.exec(e.initialHTML);)s.push(r[1]);let o=e.initialHTML;s.forEach((t=>o=o.replaceAll("${"+t+"}",(this.executeRawExpression(t.replaceAll("#","this."),i)||"").toString()))),t.innerHTML=o}if(t.hasAttribute(S_EVAL)){let s=this.executeRawExpression(e.initialHTML,i);t.innerHTML=null!=s?s.toString():""}},Space.prototype.executeRawExpression=function(expression,data){try{let obj=Object.assign({ex:function(){return eval(expression)}},data),result=obj.ex();return result?result.toString():""}catch(t){console.log("Template Exception: >>"+expression+"<<"),console.log(t)}},Space.prototype.renderItem=function(t,e,i){let s=this;this.getItemsByClassName("sid"+t).forEach((function(n){for(let r=0;r<s.bindCollections.directives.length;r++)if(s.bindCollections.directives[r].id==t){let o=s.bindCollections.directives[r],l=s.replaceDirective(o.initialHTML,e,i),a=s.bindDictionary["$item_"+t]||[];for(let t=0;t<a.length;t++)l=s.replaceDirective(l,a[t],s.data[a[t]]);n.innerHTML=l}}))},Space.prototype.buildBindedData=function(t){let e=this,i={};for(const[s,n]of Object.entries(t))Array.isArray(n)?i[s]=new SpaceArray(n):function(){let t=n;Object.defineProperty(i,s,{get:()=>t,set(i){t=i,e.triggerRefresh(s,i)},configurable:!0,enumerable:!0})}();this.data=i},SpaceArray.prototype.triggerArrayChange=function(t,e,i){let s="lp_ch"+e+"_"+t,n=space.getItemsByClassName(s)[0],r=n.getAttribute("parent_sid"),o=space.bindCollections.loops.find((t=>r==t.id)).initialHTML;o=space.replaceLoopItems(o,n.getAttribute("data_name"),i),n.innerHTML=o},SpaceArray.prototype.createArrayTriggers=function(t,e,i,s){let n=this,r=this,o=s;return function(){let t=e;Object.defineProperty(r,i,{get:()=>t,set(e){t=e,r.list[i]=e,n.triggerArrayChange(i,o.toString(),e)},configurable:!0,enumerable:!0})}(),r};